<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ChordPro Viewer — Unified Screen & Print (Option 2)</title>
<style>
  :root{
    /* Base palette */
    --page-bg:#f7f8fa; --card-bg:#ffffff; --muted:#6b7280; --accent:#1f6feb;

    /* Screen tints for sections */
    --generic-bg:#f8f9fa;
    --verse-bg:#f3fdf3;
    --chorus-bg:#eef6ff;
    --bridge-bg:#fffbea;
    --intro-bg:#f9f5ff;
    --interlude-bg:#faf5ff;
    --outro-bg:#f8f5f9;

    /* Accents for badges/lines */
    --generic-ac:#cfd8dc;
    --verse-ac:#81c784;
    --chorus-ac:#64b5f6;
    --bridge-ac:#f6d860;
    --intro-ac:#b39ddb;
    --interlude-ac:#ce93d8;
    --outro-ac:#b39ddb;

    /* Typography (auto-scaled by JS) */
    --lyric-size:16px;     /* normal target */
    --chord-size:17px;     /* normal target */
    --pre-line:1.6;        /* line height for <pre> rows */
    --section-title:16px;  /* section title text */
    --meta-size:14px;      /* meta rows in header */
    --badge-font:12px;     /* badge number/letter */
    --title-size:32px;     /* song title */
    --subtitle-size:18px;

    /* Layout */
    --viewer-pad:24px;     /* viewer padding */
    --column-gap:22mm;     /* gap when two columns */
    --header-gap:10px;
    --pre-margin:8px;
  }

  html,body{height:100%;margin:0;background:var(--page-bg);font-family:Georgia,"Times New Roman",serif;color:#111}
  .wrap{max-width:900px;margin:28px auto;padding:18px}
  header h1{margin:0 0 4px 0;font-size:28px;font-weight:800}
  header p{margin:0 0 18px 0;color:var(--muted);font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif}

  .card{background:var(--card-bg);border-radius:12px;padding:16px;box-shadow:0 2px 6px rgba(0,0,0,.08);margin-bottom:14px}
  textarea#source{width:100%;min-height:200px;border-radius:8px;padding:14px;border:1px solid #e1e4ea;font-family:monospace;font-size:14px;line-height:1.4}

  /* Controls */
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
  .btn{padding:8px 14px;border-radius:8px;cursor:pointer;font-family:system-ui;border:1px solid var(--accent);background:#fff;color:var(--accent)}
  .btn.primary{background:var(--accent);color:#fff}
  .controls .right{margin-left:auto;display:flex;align-items:center;gap:8px}
  select#keySelect{padding:8px;border-radius:8px;border:1px solid #bfc6d9;font-weight:600}

  /* Viewer */
  .viewer{background:#fff;border-radius:12px;padding:var(--viewer-pad);box-shadow:0 2px 6px rgba(0,0,0,.06)}
  .title{font-size:var(--title-size);font-weight:800;margin:0 0 4px 0}
  .subtitle{font-size:var(--subtitle-size);font-style:italic;color:var(--muted);margin:0 0 6px 0}
  .meta-row{font-size:var(--meta-size);color:var(--muted);font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif}

  /* Header box */
  .header-box{border:1px solid #dce2ea;border-radius:12px;padding:14px 16px;margin-bottom:12px}
  .viewer > .header-box{-webkit-column-span:all;column-span:all;width:100%;box-sizing:border-box;}
  .header-content{text-align:center}
  .header-badges{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:10px;margin-top:var(--header-gap);}
  .header-badge{min-width:26px;height:26px;display:flex;align-items:center;justify-content:center;font-size:var(--badge-font);font-weight:800;border-radius:50%;border:2px solid var(--generic-ac);background:#fff;color:#111;padding:0 6px;}
  .header-badge.type-verse{border-color:var(--verse-ac)}
  .header-badge.type-prechorus{border-color:#ffb74d}
  .header-badge.type-chorus{border-color:var(--chorus-ac)}
  .header-badge.type-bridge{border-color:var(--bridge-ac)}
  .header-badge.type-intro{border-color:var(--intro-ac)}
  .header-badge.type-interlude{border-color:var(--interlude-ac)}
  .header-badge.type-outro{border-color:var(--outro-ac)}

  /* Section boxes */
  .section-box{margin:12px 0!important;border-radius:12px;border:1px solid #dce2ea;background:var(--generic-bg);}
  .section-box.verse{background:var(--verse-bg)}
  .section-box.chorus{background:var(--chorus-bg)}
  .section-box.bridge{background:var(--bridge-bg)}
  .section-box.intro{background:var(--intro-bg)}
  .section-box.interlude{background:var(--interlude-bg)}
  .section-box.outro{background:var(--outro-bg)}

  .section-head{position:relative;padding:18px 16px 4px 16px;}
  .section-title{margin:8px 0 0 0;font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;font-weight:700;color:#1f6feb;font-size:var(--section-title);}
  .section-badge{position:absolute;top:-14px;left:16px;min-width:26px;height:26px;border-radius:50%;background:#fff;border:2px solid var(--generic-ac);font-size:var(--badge-font);font-weight:800;display:flex;align-items:center;justify-content:center;}
  .section-line{position:absolute;top:0;left:52px;right:16px;height:2px;background:var(--generic-ac);border-radius:3px;}
  .section-body{padding:0 16px 8px 16px;}

  pre{font-family:"Courier New",Courier,monospace;white-space:pre;font-size:var(--lyric-size);line-height:1.25!important;margin:2px 0!important;padding:2px 0!important;background:transparent!important;border:none!important;}
  .chord-strong{font-weight:700;font-size:var(--chord-size)}

  .viewer.two-col{column-count:2;column-gap:var(--column-gap);column-fill:auto;}

  .comment{color:var(--muted);font-style:italic;margin:6px 0;padding-left:6px;border-left:2px solid #f0f0f0}
  .comment.box{border-left:4px solid #ccc;background:#f8f8f8;padding:8px;border-radius:6px;font-style:normal;color:#333}

  footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}

  @media print{
    body{margin:12mm;background:#fff}
    .controls,.no-print{display:none!important}
    .viewer{box-shadow:none;padding:0}
    @page{size:Letter;margin:12mm;}
    pre{line-height:1.25!important;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ChordPro Viewer</h1>
      <p>Unified screen/print, badges locked to titles, sections flow across columns, preserves chord alignment.</p>
    </header>

    <div class="card">
      <label for="source" style="display:block;font-weight:600;margin-bottom:8px">ChordPro source</label>
      <textarea id="source" placeholder="{start_header}
{title: *******}
{artist: ***}
{key: C}
{time: 4/4}
{tempo: 000}
{comment_box: Key changed to: [C]}
{section_list: I, V1, C, B }
{end_header}

{comment: Intro} 		
[C]   [C]   [C]   [C]
{comment: Verso}		                 
H[C]A
{comment_italic: Comentarios}		                 

{start_of_chorus}
T[C]a
T[C]b
{end_of_chorus}
{comment: Interludio}	
[C]  [C]  [C]  [C]
{comment: Interludio 2}	
[C]   [C]  [C]  [C]
{start_of_bridge}		
[C]Abc
{end_of_bridge}"></textarea>

      <div class="controls no-print">
        <button id="render" class="btn primary">Render</button>
        <button id="downloadCho" class="btn">Download .cho</button>
        <button id="shareLink" class="btn">Share Link</button>
        <button id="exportPdf" class="btn">Export PDF / Print</button>
        <button id="exportDocs" class="btn">Export for Google Docs</button><!-- ✅ New button -->
        <div class="right">
          <label for="keySelect" style="font-weight:600;margin-right:6px;color:#333">Select Key:</label>
          <select id="keySelect" aria-label="Transpose to key" title="Transpose to key">
            <option value="">(original)</option>
          </select>
        </div>
      </div>
    </div>

    <div id="outputArea" class="viewer card" aria-live="polite"></div>
    <footer>ChordPro Viewer — same look on screen and print; badges pinned; sections can flow.</footer>
  </div>

<script>
/* ================== (All your existing JavaScript code here — unchanged) ================== */
/* [Your full JS from transpose, render, exportPdf, etc. remains intact] */

/* ✅ New: Export for Google Docs */
document.getElementById('exportDocs').addEventListener('click', () => {
  const viewerEl = document.getElementById('outputArea');
  const hasTwoCols = viewerEl.classList.contains('two-col');
  const content = viewerEl.innerHTML;

  // Gather all styles
  const styles = Array.from(document.querySelectorAll('style'))
    .map(s => s.outerHTML)
    .join('\n');

  const html = `
    <!doctype html>
    <html>
    <head>
      <meta charset="utf-8">
      <title>ChordPro Export for Google Docs</title>
      ${styles}
      <style>
        body { margin: 24px; background: #fff; }
        .viewer { background: #fff; box-shadow: none; padding: var(--viewer-pad); }
      </style>
    </head>
    <body>
      <div class="viewer${hasTwoCols ? ' two-col' : ''}">
        ${content}
      </div>
      <footer style="margin-top:20px;text-align:center;color:#999;font-size:13px">
        Exported from ChordPro Viewer — ready for Google Docs import
      </footer>
    </body>
    </html>
  `;

  const newTab = window.open();
  newTab.document.write(html);
  newTab.document.close();
});
</script>
</body>
</html>
